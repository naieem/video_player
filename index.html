<!DOCTYPE html>
<html>
<script type="text/javascript" src="cordova.js"></script>
<script src="angular.js" type="text/javascript" charset="utf-8" async defer></script>

<body ng-app="myApp" ng-controller="myCtrl">
    <div style="text-align:center">
        <div>
        {{images | json}}
            <ul>
                <li ng-repeat="image in images">
                    <img src="{{image}}">
                </li>
            </ul>
        </div>
    </div>
    <script type="text/javascript" charset="utf-8">
    var app = angular.module('myApp', []);
    app.controller('myCtrl', function($scope) {
        $scope.images = [];
        document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady() {
            var myPath = cordova.file.externalRootDirectory + 'DCIM/Camera/';
            alert(myPath);

            function listPath(myPath) {
                window.resolveLocalFileSystemURL(myPath, function(dirEntry) {
                    var directoryReader = dirEntry.createReader();
                    directoryReader.readEntries(onSuccessCallback, onFailCallback);
                });

                function onSuccessCallback(entries) {
                    alert(entries.length);
                    for (i = 0; i < entries.length; i++) {
                        var row = entries[i];
                        var html = '';
                        // if (row.isDirectory) {
                        //     // We will draw the content of the clicked folder
                        //     html = '<li onclick="listPath(' + "'" + row.nativeURL + "'" + ');">' + row.name + '</li>';
                        // } else {
                        //     // alert the path of file
                        //     html = '<li onclick="getFilepath(' + "'" + row.nativeURL + "'" + ');">' + row.name + '</li>';
                        // }
                        // if (row.name === "DCIM") {
                        //     alert("this is gallery");
                        //     var dcimReader = entries[i].createReader();
                        //     dcimReader.readEntries(onGetDCIM, function() {
                        //         alert("fail to ead");
                        //     });
                        //     break;
                        // }
                        alert(entries[i].name);
                        var tmp = myPath + entries[i].name;
                        $scope.images.push(tmp);

                    }

                    // document.getElementById("select-demo").innerHTML = html;
                }

                function onGetDCIM(entries) {
                    var i;
                    alert(entries.length);
                    for (i = 0; i < entries.length; i++) {
                        if (entries[i].name === "Camera") {
                            var mediaReader = entries[i].createReader();
                            mediaReader.readEntries(onGetFileNames, function() {
                                alert("fail to ead");
                            });
                            break; // remove this to traverse through all the folders and files
                        }
                        //This will log all files and directories inside 100MEDIA
                        // window.console.log(" >>>>>>> " + entries[i].name);
                    }
                }

                function onGetFileNames(entries) {
                    alert(entries.length);
                    var i;
                    for (i = 0; i < entries.length; i++) {
                        if (/\.(jpe?g|png|gif|bmp)$/i.test(entries[i].name)) {
                            alert(entries[i].name);
                        }
                        // //This will log all image files found
                        // window.console.log(" $$$$$ " + entries[i].name);
                    }
                }

                function onFailCallback(e) {
                    alert(e);
                    // In case of error
                }
            }

            function getFilepath(thefilepath) {
                alert(thefilepath);
            }
            listPath(myPath);
            // listPath("file://storage/0");
        }
    });
    </script>
</body>

</html>
